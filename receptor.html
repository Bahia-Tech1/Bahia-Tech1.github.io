<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Remoto</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #222; color: #fff; display: flex; flex-direction: column; height: 100vh; margin: 0; }
        #video-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; background: #000; }
        video { max-width: 100%; max-height: 100%; }
        #controls { padding: 20px; background: #333; }
        input { padding: 10px; width: 60%; text-align: center; }
        button.connect { padding: 10px; background: #2196F3; color: white; border: none; cursor: pointer; width: 30%; }
        .btn-snap { background: #ff4757; color: white; width: 70px; height: 70px; border-radius: 50%; border: 3px solid #fff; font-size: 24px; cursor: pointer; display: none; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="video-container">
        <video id="remoteVideo" autoplay playsinline></video>
    </div>

    <div id="controls">
        <div id="login">
            <input type="text" id="remoteId" value="camara-bahia" placeholder="Nombre de la cÃ¡mara">
            <button class="connect" onclick="conectar()">Ver</button>
        </div>
        <button id="btnSnap" class="btn-snap" onclick="pedirFoto()">ðŸ“·</button>
        <p id="msg" style="color:#aaa; font-size:12px; margin-top:5px;">Listo para conectar</p>
    </div>

    <script>
        const peer = new Peer(); 
        const remoteVideo = document.getElementById('remoteVideo');
        const msg = document.getElementById('msg');
        let dataConn = null;

        function conectar() {
            const targetId = document.getElementById('remoteId').value;
            if(!targetId) return;

            msg.innerText = "Buscando a " + targetId + "...";

            // Conectar Video
            const call = peer.call(targetId, null);
            
            // Manejo de errores al llamar
            if(!call) return alert("Error al crear llamada");
            
            // Si la llamada falla despuÃ©s de iniciar (ej: ID no existe)
            setTimeout(() => {
                if(!remoteVideo.srcObject) msg.innerText = "No responde... Â¿EstÃ¡ prendida la cÃ¡mara?";
            }, 4000);

            call.on('stream', (stream) => {
                msg.innerText = "Â¡Conectado!";
                remoteVideo.srcObject = stream;
                document.getElementById('login').style.display = 'none';
                document.getElementById('btnSnap').style.display = 'inline-block';
            });

            call.on('error', (err) => {
                 alert("Error llamada: " + err);
            });

            // Conectar Datos (BotÃ³n)
            dataConn = peer.connect(targetId);
        }

        function pedirFoto() {
            if(dataConn) dataConn.send('TOMAR_FOTO');
        }
    </script>
</body>
</html>
